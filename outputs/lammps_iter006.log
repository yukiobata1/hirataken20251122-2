LAMMPS (22 Jul 2025 - Update 2)
KOKKOS mode with Kokkos version 4.6.2 is enabled
  will use up to 1 GPU(s) per node
  using 1 OpenMP thread(s) per MPI task
package kokkos
# H100 GPU-Optimized LAMMPS input for EPSR simulation of EGaIn eutectic alloy
# Composition: Ga0.858In0.142
# Temperature: 150Â°C (423.15 K)
# Potential: LJ + Empirical Potential (table)
# GPU: Using KOKKOS for H100 (Hopper architecture)

# ========== KOKKOS Initialization (CRITICAL: Must be first) ==========
# CRITICAL FIX: newton off prevents KOKKOS errors on H100
# Note: pair_style table does not have /kk support, but will run on CPU while LJ runs on GPU
package         kokkos neigh full newton off

# ========== Initialization ==========
units           real
atom_style      atomic
boundary        p p p

# ========== Force field ==========
# Use hybrid/overlay to combine LJ (GPU-accelerated) and table (CPU)
# The -sf kk flag will automatically use lj/cut/kk while table runs on CPU
# NOTE: pair_style must be defined BEFORE read_data if data file contains Pair Coeffs section
pair_style      hybrid/overlay lj/cut 12.0 table linear 200

# ========== Read structure ==========
# Use LJ-equilibrated structure as initial configuration (more stable)
shell           mkdir -p outputs
# nocoeff skips Pair Coeffs section which is incompatible with hybrid/overlay
read_data       outputs/final_structure_lj_H100.data nocoeff
Reading data file ...
  orthogonal box = (0 0 0) to (73.839453 73.839453 73.839453)
  1 by 1 by 1 MPI processor grid
WARNING: Pair style lj/cut/kk in data file differs from currently defined pair style zero (src/read_data.cpp:811)
  reading atoms ...
  20000 atoms
  reading velocities ...
  20000 velocities
  read_data CPU = 0.097 seconds

# LJ potential (GPU-accelerated with -sf kk flag)
pair_coeff      1 1 lj/cut 0.430 2.70    # Ga-Ga
pair_coeff      2 2 lj/cut 0.430 3.11    # In-In
pair_coeff      1 2 lj/cut 0.430 2.905   # Ga-In

# Empirical potential (from table files - runs on CPU)
# Table format: r, U(r), F(r)
pair_coeff      1 1 table data/ep_GaGa.table EP_GAGA 12.0
pair_coeff      2 2 table data/ep_InIn.table EP_ININ 12.0
pair_coeff      1 2 table data/ep_GaIn.table EP_GAIN 12.0

# ========== Settings ==========
mass            1 69.723    # Ga
mass            2 114.818   # In

# Optimized neighbor list for GPU
neighbor        2.0 bin
neigh_modify    delay 0 every 1 check yes binsize 4.0

# ========== Initial velocity ==========
# Re-initialize velocities for this temperature
velocity        all create 423.15 12345 dist gaussian

# ========== Thermodynamic output ==========
thermo          1000
thermo_style    custom step temp pe ke etotal press vol density cpu

# ========== Quick minimization for stability ==========
print "========== Energy Minimization =========="
========== Energy Minimization ==========
minimize        1.0e-4 1.0e-6 1000 10000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  2 neighbor lists, perpetual/occasional/extra = 2 0 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
WARNING: Fix MINIMIZE/kk not compatible with sending data in Kokkos communication (src/KOKKOS/comm_kokkos.cpp:767)
WARNING: Fix with atom-based arrays not compatible with sending data in Kokkos communication, switching to classic exchange/border communication (src/KOKKOS/comm_kokkos.cpp:780)
WARNING: Fix MINIMIZE/kk not compatible with Kokkos sorting on device (src/KOKKOS/atom_kokkos.cpp:212)
WARNING: Fix with atom-based arrays not compatible with Kokkos sorting on device, switching to classic host sorting (src/KOKKOS/atom_kokkos.cpp:218)
Per MPI rank memory allocation (min/avg/max) = 13.71 | 13.71 | 13.71 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
         0   423.15        -1187987.4      25225.334     -1162762.1      42811.834      402592.25      6.2796667      0            
        18   423.15        -1211320.3      25225.334     -1186095        35232.01       402592.25      6.2796667      0.032270414  
Loop time of 0.0322776 on 1 procs for 18 steps with 20000 atoms

94.3% CPU use with 1 MPI tasks x 1 OpenMP threads

Minimization stats:
  Stopping criterion = energy tolerance
  Energy initial, next-to-last, final = 
     -1187987.44111751  -1211220.29694661   -1211320.3097157
  Force two-norm initial, final = 1372.6903 104.14351
  Force max component initial, final = 43.037705 3.1164186
  Final line search alpha, max atom move = 0.0064118857 0.01998212
  Iterations, force evaluations = 18 18

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.023006   | 0.023006   | 0.023006   |   0.0 | 71.28
Neigh   | 0.0012735  | 0.0012735  | 0.0012735  |   0.0 |  3.95
Comm    | 0.0025453  | 0.0025453  | 0.0025453  |   0.0 |  7.89
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0          | 0          | 0          |   0.0 |  0.00
Other   |            | 0.005453   |            |       | 16.89

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32453 ave       32453 max       32453 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14132e+07 ave 1.14132e+07 max 1.14132e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11413230
Ave neighs/atom = 570.6615
Neighbor list builds = 1
Dangerous builds = 0
reset_timestep  0

# ========== RDF computation ==========
# Compute total and partial pair distribution functions
compute         myrdf all rdf 200 1 1 1 2 2 2 cutoff 12.0

# Time-average RDF output
fix             rdfout all ave/time 100 10 1000 c_myrdf[*] file rdf.dat mode vector

# ========== Equilibration (NVT) ==========
print "========== H100 GPU Equilibration =========="
========== H100 GPU Equilibration ==========

# Start with small timestep for stability
timestep        0.5

fix             nvt all nvt temp 423.15 423.15 100.0
run             5000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  3 neighbor lists, perpetual/occasional/extra = 2 1 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
  (3) compute rdf, occasional
      attributes: half, newton off
      pair build: half/bin/atomonly/newtoff
      stencil: full/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 12.06 | 12.06 | 12.06 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
         0   423.15        -1211320.3      25225.334     -1186095        35232.01       402592.25      6.2796667      0            
      1000   358.17773     -1198415.8      21352.128     -1177063.6      43348.981      402592.25      6.2796667      3.0815753    
      2000   431.61019     -1194645.5      25729.673     -1168915.8      46240.115      402592.25      6.2796667      6.153198     
      3000   426.39551     -1194507.5      25418.809     -1169088.7      46223.329      402592.25      6.2796667      9.2212033    
      4000   424.59574     -1194668        25311.519     -1169356.5      45975.661      402592.25      6.2796667      12.300121    
      5000   423.75374     -1195100.1      25261.325     -1169838.8      45919.956      402592.25      6.2796667      15.372887    
Loop time of 15.3729 on 1 procs for 5000 steps with 20000 atoms

Performance: 14.051 ns/day, 1.708 hours/ns, 325.248 timesteps/s, 6.505 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 2.4988     | 2.4988     | 2.4988     |   0.0 | 16.25
Neigh   | 0.038951   | 0.038951   | 0.038951   |   0.0 |  0.25
Comm    | 0.051205   | 0.051205   | 0.051205   |   0.0 |  0.33
Output  | 0.0017388  | 0.0017388  | 0.0017388  |   0.0 |  0.01
Modify  | 12.61      | 12.61      | 12.61      |   0.0 | 82.03
Other   |            | 0.1718     |            |       |  1.12

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32460 ave       32460 max       32460 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.85277e+06 ave 6.85277e+06 max 6.85277e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14196e+07 ave 1.14196e+07 max 1.14196e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11419576
Ave neighs/atom = 570.9788
Neighbor list builds = 24
Dangerous builds = 0
unfix           nvt

# Increase timestep to normal
timestep        2.0

fix             nvt all nvt temp 423.15 423.15 100.0
run             15000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Per MPI rank memory allocation (min/avg/max) = 38.39 | 38.39 | 38.39 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
      5000   423.75374     -1195100.1      25261.325     -1169838.8      45919.956      402592.25      6.2796667      0            
      6000   424.47464     -1194905.2      25304.3       -1169600.9      46000.809      402592.25      6.2796667      4.1653175    
      7000   418.3384      -1195096.8      24938.499     -1170158.3      45904.442      402592.25      6.2796667      8.3342898    
      8000   422.64561     -1195354        25195.266     -1170158.8      45953.321      402592.25      6.2796667      12.510889    
      9000   419.78079     -1194972.3      25024.485     -1169947.9      45949.875      402592.25      6.2796667      16.681813    
     10000   424.79268     -1195395.4      25323.26      -1170072.1      45943.865      402592.25      6.2796667      20.854108    
     11000   422.61758     -1195368.4      25193.595     -1170174.8      45984.034      402592.25      6.2796667      25.018175    
     12000   421.55461     -1194654        25130.228     -1169523.8      46126.856      402592.25      6.2796667      29.185518    
     13000   427.74158     -1195086.7      25499.053     -1169587.7      45858.743      402592.25      6.2796667      33.354306    
     14000   423.31998     -1194787.1      25235.467     -1169551.7      46004.041      402592.25      6.2796667      37.523558    
     15000   422.84084     -1195136.4      25206.904     -1169929.5      45873.623      402592.25      6.2796667      41.693378    
     16000   423.46324     -1195084.6      25244.007     -1169840.6      46006.77       402592.25      6.2796667      45.861904    
     17000   424.21802     -1195299.3      25289.002     -1170010.3      45922.948      402592.25      6.2796667      50.032513    
     18000   422.57567     -1195552.4      25191.096     -1170361.3      45865.703      402592.25      6.2796667      54.192667    
     19000   424.55461     -1194912.8      25309.067     -1169603.7      45985.124      402592.25      6.2796667      58.361092    
     20000   423.89386     -1195098.5      25269.678     -1169828.8      45989.181      402592.25      6.2796667      62.525812    
Loop time of 62.5258 on 1 procs for 15000 steps with 20000 atoms

Performance: 41.455 ns/day, 0.579 hours/ns, 239.901 timesteps/s, 4.798 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 7.5895     | 7.5895     | 7.5895     |   0.0 | 12.14
Neigh   | 0.46209    | 0.46209    | 0.46209    |   0.0 |  0.74
Comm    | 0.37053    | 0.37053    | 0.37053    |   0.0 |  0.59
Output  | 0.005283   | 0.005283   | 0.005283   |   0.0 |  0.01
Modify  | 53.494     | 53.494     | 53.494     |   0.0 | 85.56
Other   |            | 0.6042     |            |       |  0.97

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32377 ave       32377 max       32377 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.85354e+06 ave 6.85354e+06 max 6.85354e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14193e+07 ave 1.14193e+07 max 1.14193e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11419308
Ave neighs/atom = 570.9654
Neighbor list builds = 291
Dangerous builds = 0
unfix           nvt

# ========== Production (NVT) ==========
print "========== H100 GPU Production run =========="
========== H100 GPU Production run ==========

fix             nvt all nvt temp 423.15 423.15 100.0

# Reset RDF for production run
uncompute       myrdf
compute         myrdf all rdf 200 1 1 1 2 2 2 cutoff 12.0
unfix           rdfout
fix             rdfout all ave/time 100 10 1000 c_myrdf[*] file rdf.dat mode vector

run             50000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  3 neighbor lists, perpetual/occasional/extra = 2 1 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
  (3) compute rdf, occasional
      attributes: half, newton off
      pair build: half/bin/atomonly/newtoff
      stencil: full/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 12.06 | 12.06 | 12.06 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
     20000   423.89386     -1195098.5      25269.678     -1169828.8      45989.181      402592.25      6.2796667      0            
     21000   423.06868     -1194955.5      25220.486     -1169735        46069.337      402592.25      6.2796667      4.1686428    
     22000   422.87137     -1194977.7      25208.724     -1169768.9      46024.678      402592.25      6.2796667      8.3427219    
     23000   420.50238     -1194824.7      25067.501     -1169757.2      45981.409      402592.25      6.2796667      12.508667    
     24000   426.90494     -1194949.8      25449.178     -1169500.7      45980.546      402592.25      6.2796667      16.682023    
     25000   419.36307     -1195449        24999.583     -1170449.4      45730.147      402592.25      6.2796667      20.849132    
     26000   420.76055     -1194940.7      25082.891     -1169857.8      45835.26       402592.25      6.2796667      25.018341    
     27000   421.40793     -1194723.4      25121.484     -1169601.9      45995.326      402592.25      6.2796667      29.182432    
     28000   421.8043      -1194889.8      25145.113     -1169744.7      46042.394      402592.25      6.2796667      33.349964    
     29000   422.17604     -1194809.6      25167.273     -1169642.4      46116.063      402592.25      6.2796667      37.516614    
     30000   424.05982     -1194919.8      25279.571     -1169640.2      45982.286      402592.25      6.2796667      41.684073    
     31000   429.80452     -1194326.4      25622.031     -1168704.3      46046.91       402592.25      6.2796667      45.847356    
     32000   422.81953     -1194838.9      25205.634     -1169633.3      45978.974      402592.25      6.2796667      50.007442    
     33000   423.12586     -1194729        25223.895     -1169505.1      45969.122      402592.25      6.2796667      54.170264    
     34000   424.51508     -1194878.6      25306.711     -1169571.9      46194.817      402592.25      6.2796667      58.34343     
     35000   427.36417     -1194787.4      25476.554     -1169310.8      46069.864      402592.25      6.2796667      62.496491    
     36000   426.89649     -1194732.8      25448.675     -1169284.2      45849.171      402592.25      6.2796667      66.674396    
     37000   425.24329     -1194837.1      25350.122     -1169487        45944.98       402592.25      6.2796667      70.83776     
     38000   427.32047     -1194793.6      25473.949     -1169319.7      46029.865      402592.25      6.2796667      75.003182    
     39000   421.00631     -1195222.3      25097.542     -1170124.8      46034.384      402592.25      6.2796667      79.168601    
     40000   424.09623     -1194506.4      25281.742     -1169224.7      46091.845      402592.25      6.2796667      83.325757    
     41000   425.97785     -1195220.8      25393.911     -1169826.9      45871.902      402592.25      6.2796667      87.495567    
     42000   426.46668     -1194911.5      25423.052     -1169488.5      46299.578      402592.25      6.2796667      91.66102     
     43000   421.54001     -1195036.7      25129.357     -1169907.3      45890.937      402592.25      6.2796667      95.831189    
     44000   422.97282     -1194782.8      25214.772     -1169568        45971.413      402592.25      6.2796667      100.00323    
     45000   422.52354     -1194883.9      25187.989     -1169695.9      45990.414      402592.25      6.2796667      104.16877    
     46000   421.61716     -1194554        25133.957     -1169420        46192.335      402592.25      6.2796667      108.3344     
     47000   423.27589     -1194705.2      25232.839     -1169472.4      45911.653      402592.25      6.2796667      112.51024    
     48000   424.50973     -1195031.9      25306.392     -1169725.5      45914.988      402592.25      6.2796667      116.672      
     49000   423.31913     -1194404.3      25235.417     -1169168.9      46190.87       402592.25      6.2796667      120.83922    
     50000   422.95329     -1194990.9      25213.608     -1169777.3      45897.18       402592.25      6.2796667      125.01798    
     51000   423.70618     -1194840.4      25258.49      -1169581.9      45980.177      402592.25      6.2796667      129.19449    
     52000   419.43382     -1194992.3      25003.801     -1169988.5      45934.327      402592.25      6.2796667      133.37169    
     53000   425.37524     -1195137.4      25357.988     -1169779.4      45816.531      402592.25      6.2796667      137.5362     
     54000   421.05733     -1194651.6      25100.583     -1169551        46142.195      402592.25      6.2796667      141.71282    
     55000   418.8272      -1194488.5      24967.638     -1169520.9      45886.221      402592.25      6.2796667      145.88417    
     56000   425.90742     -1194729.2      25389.713     -1169339.5      46064.962      402592.25      6.2796667      150.05403    
     57000   418.56878     -1194701.5      24952.233     -1169749.3      45906.43       402592.25      6.2796667      154.23669    
     58000   426.03339     -1195015.8      25397.222     -1169618.6      46128.155      402592.25      6.2796667      158.41336    
     59000   420.13273     -1194696.6      25045.465     -1169651.2      45897.33       402592.25      6.2796667      162.58346    
     60000   422.88262     -1194855.8      25209.395     -1169646.4      46068.576      402592.25      6.2796667      166.75543    
     61000   426.72044     -1194584        25438.18      -1169145.8      45828.958      402592.25      6.2796667      170.92156    
     62000   423.62433     -1194985.6      25253.611     -1169731.9      45919.933      402592.25      6.2796667      175.08169    
     63000   424.33043     -1194914.5      25295.703     -1169618.8      45999.505      402592.25      6.2796667      179.24236    
     64000   423.56884     -1195233.5      25250.303     -1169983.2      45719.623      402592.25      6.2796667      183.41471    
     65000   425.11436     -1194639.8      25342.436     -1169297.4      46047.855      402592.25      6.2796667      187.5703     
     66000   420.45174     -1194900.8      25064.482     -1169836.3      45950.098      402592.25      6.2796667      191.73777    
     67000   427.34908     -1194698.1      25475.655     -1169222.5      46032.66       402592.25      6.2796667      195.8997     
     68000   422.49906     -1194751.9      25186.529     -1169565.4      46048.616      402592.25      6.2796667      200.06399    
     69000   421.64454     -1194758.2      25135.589     -1169622.7      45966.158      402592.25      6.2796667      204.23165    
     70000   421.19851     -1194799.7      25108.999     -1169690.7      46135.882      402592.25      6.2796667      208.40384    
Loop time of 208.404 on 1 procs for 50000 steps with 20000 atoms

Performance: 41.458 ns/day, 0.579 hours/ns, 239.919 timesteps/s, 4.798 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 25.28      | 25.28      | 25.28      |   0.0 | 12.13
Neigh   | 1.5503     | 1.5503     | 1.5503     |   0.0 |  0.74
Comm    | 1.2438     | 1.2438     | 1.2438     |   0.0 |  0.60
Output  | 0.017667   | 0.017667   | 0.017667   |   0.0 |  0.01
Modify  | 178.3      | 178.3      | 178.3      |   0.0 | 85.55
Other   |            | 2.013      |            |       |  0.97

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32455 ave       32455 max       32455 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.84889e+06 ave 6.84889e+06 max 6.84889e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14193e+07 ave 1.14193e+07 max 1.14193e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11419316
Ave neighs/atom = 570.9658
Neighbor list builds = 976
Dangerous builds = 0
unfix           nvt

# ========== Finalize ==========
print "========== H100 GPU Simulation completed =========="
========== H100 GPU Simulation completed ==========

# Write restart file for next iteration (use fixed name to avoid shell command issues)
write_restart   outputs/restart.0.data
System init for write_restart ...
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule

# Final statistics
variable        density_final equal density
variable        temp_final equal temp
variable        press_final equal press

print "========================================="
=========================================
print "FINAL RESULTS:"
FINAL RESULTS:
print "  Density:     ${density_final} g/cm^3"
  Density:     6.27966666056994 g/cm^3
print "  Temperature: ${temp_final} K"
  Temperature: 421.198508237523 K
print "  Pressure:    ${press_final} bar"
  Pressure:    46135.8815736612 bar
print "========================================="
=========================================

print "RDF written to rdf.dat"
RDF written to rdf.dat
print "Restart file written to outputs/restart.0.data"
Restart file written to outputs/restart.0.data
Total wall time: 0:04:46
