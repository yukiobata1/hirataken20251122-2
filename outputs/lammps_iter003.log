LAMMPS (22 Jul 2025 - Update 2)
KOKKOS mode with Kokkos version 4.6.2 is enabled
  will use up to 1 GPU(s) per node
  using 1 OpenMP thread(s) per MPI task
package kokkos
# H100 GPU-Optimized LAMMPS input for EPSR simulation of EGaIn eutectic alloy
# Composition: Ga0.858In0.142
# Temperature: 150Â°C (423.15 K)
# Potential: LJ + Empirical Potential (table)
# GPU: Using KOKKOS for H100 (Hopper architecture)

# ========== KOKKOS Initialization (CRITICAL: Must be first) ==========
# CRITICAL FIX: newton off prevents KOKKOS errors on H100
# Note: pair_style table does not have /kk support, but will run on CPU while LJ runs on GPU
package         kokkos neigh full newton off

# ========== Initialization ==========
units           real
atom_style      atomic
boundary        p p p

# ========== Force field ==========
# Use hybrid/overlay to combine LJ (GPU-accelerated) and table (CPU)
# The -sf kk flag will automatically use lj/cut/kk while table runs on CPU
# NOTE: pair_style must be defined BEFORE read_data if data file contains Pair Coeffs section
pair_style      hybrid/overlay lj/cut 12.0 table linear 200

# ========== Read structure ==========
# Use LJ-equilibrated structure as initial configuration (more stable)
shell           mkdir -p outputs
# nocoeff skips Pair Coeffs section which is incompatible with hybrid/overlay
read_data       outputs/final_structure_lj_H100.data nocoeff
Reading data file ...
  orthogonal box = (0 0 0) to (73.839453 73.839453 73.839453)
  1 by 1 by 1 MPI processor grid
WARNING: Pair style lj/cut/kk in data file differs from currently defined pair style zero (src/read_data.cpp:811)
  reading atoms ...
  20000 atoms
  reading velocities ...
  20000 velocities
  read_data CPU = 0.099 seconds

# LJ potential (GPU-accelerated with -sf kk flag)
pair_coeff      1 1 lj/cut 0.430 2.70    # Ga-Ga
pair_coeff      2 2 lj/cut 0.430 3.11    # In-In
pair_coeff      1 2 lj/cut 0.430 2.905   # Ga-In

# Empirical potential (from table files - runs on CPU)
# Table format: r, U(r), F(r)
pair_coeff      1 1 table data/ep_GaGa.table EP_GAGA 12.0
pair_coeff      2 2 table data/ep_InIn.table EP_ININ 12.0
pair_coeff      1 2 table data/ep_GaIn.table EP_GAIN 12.0

# ========== Settings ==========
mass            1 69.723    # Ga
mass            2 114.818   # In

# Optimized neighbor list for GPU
neighbor        2.0 bin
neigh_modify    delay 0 every 1 check yes binsize 4.0

# ========== Initial velocity ==========
# Re-initialize velocities for this temperature
velocity        all create 423.15 12345 dist gaussian

# ========== Thermodynamic output ==========
thermo          1000
thermo_style    custom step temp pe ke etotal press vol density cpu

# ========== Quick minimization for stability ==========
print "========== Energy Minimization =========="
========== Energy Minimization ==========
minimize        1.0e-4 1.0e-6 1000 10000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  2 neighbor lists, perpetual/occasional/extra = 2 0 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
WARNING: Fix MINIMIZE/kk not compatible with sending data in Kokkos communication (src/KOKKOS/comm_kokkos.cpp:767)
WARNING: Fix with atom-based arrays not compatible with sending data in Kokkos communication, switching to classic exchange/border communication (src/KOKKOS/comm_kokkos.cpp:780)
WARNING: Fix MINIMIZE/kk not compatible with Kokkos sorting on device (src/KOKKOS/atom_kokkos.cpp:212)
WARNING: Fix with atom-based arrays not compatible with Kokkos sorting on device, switching to classic host sorting (src/KOKKOS/atom_kokkos.cpp:218)
Per MPI rank memory allocation (min/avg/max) = 13.71 | 13.71 | 13.71 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
         0   423.15        -158359.48      25225.334     -133134.15      60835.45       402592.25      6.2796667      0            
       118   423.15        -185166.53      25225.334     -159941.2       48864.219      402592.25      6.2796667      0.1725671    
Loop time of 0.172576 on 1 procs for 118 steps with 20000 atoms

99.2% CPU use with 1 MPI tasks x 1 OpenMP threads

Minimization stats:
  Stopping criterion = energy tolerance
  Energy initial, next-to-last, final = 
     -158359.481904398  -185154.252403865  -185166.530094831
  Force two-norm initial, final = 1468.232 23.368829
  Force max component initial, final = 43.287027 3.1035626
  Final line search alpha, max atom move = 0.011035979 0.034250852
  Iterations, force evaluations = 118 118

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.14297    | 0.14297    | 0.14297    |   0.0 | 82.85
Neigh   | 0.0049652  | 0.0049652  | 0.0049652  |   0.0 |  2.88
Comm    | 0.0062112  | 0.0062112  | 0.0062112  |   0.0 |  3.60
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0          | 0          | 0          |   0.0 |  0.00
Other   |            | 0.01843    |            |       | 10.68

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32510 ave       32510 max       32510 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14571e+07 ave 1.14571e+07 max 1.14571e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11457112
Ave neighs/atom = 572.8556
Neighbor list builds = 4
Dangerous builds = 0
reset_timestep  0

# ========== RDF computation ==========
# Compute total and partial pair distribution functions
compute         myrdf all rdf 200 1 1 1 2 2 2 cutoff 12.0

# Time-average RDF output
fix             rdfout all ave/time 100 10 1000 c_myrdf[*] file rdf.dat mode vector

# ========== Equilibration (NVT) ==========
print "========== H100 GPU Equilibration =========="
========== H100 GPU Equilibration ==========

# Start with small timestep for stability
timestep        0.5

fix             nvt all nvt temp 423.15 423.15 100.0
run             5000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  3 neighbor lists, perpetual/occasional/extra = 2 1 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
  (3) compute rdf, occasional
      attributes: half, newton off
      pair build: half/bin/atomonly/newtoff
      stencil: full/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 12.07 | 12.07 | 12.07 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
         0   423.15        -185166.53      25225.334     -159941.2       48864.219      402592.25      6.2796667      0            
      1000   321.95967     -167493.88      19193.053     -148300.82      59316.952      402592.25      6.2796667      2.876338     
      2000   430.594       -161284.03      25669.095     -135614.93      63908.896      402592.25      6.2796667      5.9448599    
      3000   421.50399     -161221.53      25127.21      -136094.32      63491.814      402592.25      6.2796667      9.0199469    
      4000   418.7116      -160796.62      24960.747     -135835.87      63809.897      402592.25      6.2796667      12.100831    
      5000   423.89791     -160816.63      25269.92      -135546.71      63600.668      402592.25      6.2796667      15.189667    
Loop time of 15.1897 on 1 procs for 5000 steps with 20000 atoms

Performance: 14.220 ns/day, 1.688 hours/ns, 329.171 timesteps/s, 6.583 Matom-step/s
99.9% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 2.4994     | 2.4994     | 2.4994     |   0.0 | 16.45
Neigh   | 0.037381   | 0.037381   | 0.037381   |   0.0 |  0.25
Comm    | 0.049253   | 0.049253   | 0.049253   |   0.0 |  0.32
Output  | 0.0017131  | 0.0017131  | 0.0017131  |   0.0 |  0.01
Modify  | 12.431     | 12.431     | 12.431     |   0.0 | 81.84
Other   |            | 0.1709     |            |       |  1.13

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32526 ave       32526 max       32526 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.85829e+06 ave 6.85829e+06 max 6.85829e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14234e+07 ave 1.14234e+07 max 1.14234e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11423426
Ave neighs/atom = 571.1713
Neighbor list builds = 23
Dangerous builds = 0
unfix           nvt

# Increase timestep to normal
timestep        2.0

fix             nvt all nvt temp 423.15 423.15 100.0
run             15000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Per MPI rank memory allocation (min/avg/max) = 38.77 | 38.77 | 38.77 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
      5000   423.89791     -160816.63      25269.92      -135546.71      63600.668      402592.25      6.2796667      0            
      6000   421.09045     -160871.78      25102.558     -135769.22      63688.508      402592.25      6.2796667      4.1615826    
      7000   424.06568     -160850.81      25279.921     -135570.89      63615.771      402592.25      6.2796667      8.3353019    
      8000   422.45366     -160709.4       25183.823     -135525.58      63737.02       402592.25      6.2796667      12.499212    
      9000   420.76916     -160937.64      25083.404     -135854.24      63725.539      402592.25      6.2796667      16.663577    
     10000   427.76627     -160715.33      25500.525     -135214.81      63954.661      402592.25      6.2796667      20.840808    
     11000   426.64758     -160938.36      25433.836     -135504.52      63748.616      402592.25      6.2796667      25.004168    
     12000   420.24412     -160927.2       25052.105     -135875.09      63787.891      402592.25      6.2796667      29.171212    
     13000   421.70769     -160916.62      25139.353     -135777.27      63445.485      402592.25      6.2796667      33.328226    
     14000   421.52079     -161127.58      25128.212     -135999.37      63682.92       402592.25      6.2796667      37.495474    
     15000   425.54633     -160800.07      25368.187     -135431.89      63754.91       402592.25      6.2796667      41.66715     
     16000   422.35552     -161104.64      25177.973     -135926.67      63688.278      402592.25      6.2796667      45.828356    
     17000   421.86358     -160894.29      25148.646     -135745.64      63555.149      402592.25      6.2796667      49.996586    
     18000   420.11605     -160719.68      25044.471     -135675.21      63770.886      402592.25      6.2796667      54.156986    
     19000   422.73599     -160772.76      25200.654     -135572.11      63846.343      402592.25      6.2796667      58.33373     
     20000   421.32926     -160880.3       25116.794     -135763.5       63621.357      402592.25      6.2796667      62.494166    
Loop time of 62.4942 on 1 procs for 15000 steps with 20000 atoms

Performance: 41.476 ns/day, 0.579 hours/ns, 240.022 timesteps/s, 4.800 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 7.5882     | 7.5882     | 7.5882     |   0.0 | 12.14
Neigh   | 0.47216    | 0.47216    | 0.47216    |   0.0 |  0.76
Comm    | 0.38139    | 0.38139    | 0.38139    |   0.0 |  0.61
Output  | 0.0056108  | 0.0056108  | 0.0056108  |   0.0 |  0.01
Modify  | 53.447     | 53.447     | 53.447     |   0.0 | 85.52
Other   |            | 0.6003     |            |       |  0.96

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32464 ave       32464 max       32464 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.85273e+06 ave 6.85273e+06 max 6.85273e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14233e+07 ave 1.14233e+07 max 1.14233e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11423274
Ave neighs/atom = 571.1637
Neighbor list builds = 293
Dangerous builds = 0
unfix           nvt

# ========== Production (NVT) ==========
print "========== H100 GPU Production run =========="
========== H100 GPU Production run ==========

fix             nvt all nvt temp 423.15 423.15 100.0

# Reset RDF for production run
uncompute       myrdf
compute         myrdf all rdf 200 1 1 1 2 2 2 cutoff 12.0
unfix           rdfout
fix             rdfout all ave/time 100 10 1000 c_myrdf[*] file rdf.dat mode vector

run             50000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  3 neighbor lists, perpetual/occasional/extra = 2 1 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
  (3) compute rdf, occasional
      attributes: half, newton off
      pair build: half/bin/atomonly/newtoff
      stencil: full/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 12.06 | 12.06 | 12.06 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
     20000   421.32926     -160880.3       25116.794     -135763.5       63621.357      402592.25      6.2796667      0            
     21000   422.99825     -160711.74      25216.288     -135495.45      63851.127      402592.25      6.2796667      4.1659238    
     22000   418.51818     -160667.21      24949.216     -135717.99      63660.906      402592.25      6.2796667      8.3228318    
     23000   422.45323     -160897.27      25183.797     -135713.47      63620.645      402592.25      6.2796667      12.485107    
     24000   425.3135      -160625.33      25354.308     -135271.02      63837.872      402592.25      6.2796667      16.647078    
     25000   423.137       -160772.73      25224.559     -135548.17      63876.433      402592.25      6.2796667      20.808521    
     26000   423.90855     -160801.79      25270.554     -135531.23      63630.844      402592.25      6.2796667      24.961548    
     27000   420.02175     -160949.46      25038.849     -135910.61      63532.334      402592.25      6.2796667      29.11927     
     28000   423.69055     -160974.56      25257.558     -135717         63615.887      402592.25      6.2796667      33.277242    
     29000   421.94002     -161117.39      25153.203     -135964.19      63599.571      402592.25      6.2796667      37.435637    
     30000   424.5551      -160880.36      25309.097     -135571.26      63629.89       402592.25      6.2796667      41.588388    
     31000   426.9283      -160909.73      25450.571     -135459.16      63637.901      402592.25      6.2796667      45.752889    
     32000   423.21642     -160944.28      25229.293     -135714.99      63615.665      402592.25      6.2796667      49.911281    
     33000   423.00214     -160825.48      25216.52      -135608.96      63624.04       402592.25      6.2796667      54.073247    
     34000   425.77272     -160754.38      25381.683     -135372.69      63789.279      402592.25      6.2796667      58.231032    
     35000   422.43698     -160596.03      25182.829     -135413.2       63982.01       402592.25      6.2796667      62.393093    
     36000   423.1858      -161166.13      25227.468     -135938.66      63458.727      402592.25      6.2796667      66.546393    
     37000   417.04356     -161203.69      24861.31      -136342.38      63438.26       402592.25      6.2796667      70.708106    
     38000   425.04738     -160775.4       25338.443     -135436.95      63793.346      402592.25      6.2796667      74.869627    
     39000   420.14428     -160842.23      25046.154     -135796.07      63686.746      402592.25      6.2796667      79.032273    
     40000   424.43216     -160776.95      25301.768     -135475.18      63708.033      402592.25      6.2796667      83.18681     
     41000   425.70294     -160883.67      25377.523     -135506.15      63733.238      402592.25      6.2796667      87.346791    
     42000   421.85772     -160867.09      25148.297     -135718.79      63658.109      402592.25      6.2796667      91.50695     
     43000   421.53631     -160923.99      25129.137     -135794.85      63535.54       402592.25      6.2796667      95.667871    
     44000   421.99445     -160726.76      25156.448     -135570.31      63854.547      402592.25      6.2796667      99.826026    
     45000   425.48255     -160819.66      25364.385     -135455.27      63776.399      402592.25      6.2796667      103.99318    
     46000   421.7611      -160850.05      25142.538     -135707.51      63609.767      402592.25      6.2796667      108.14597    
     47000   424.14888     -160489.16      25284.881     -135204.28      64043.87       402592.25      6.2796667      112.30989    
     48000   419.46687     -160879.75      25005.771     -135873.98      63601.957      402592.25      6.2796667      116.47889    
     49000   422.29238     -160919.66      25174.209     -135745.46      63726.077      402592.25      6.2796667      120.64862    
     50000   423.08069     -161072.96      25221.202     -135851.75      63466.03       402592.25      6.2796667      124.81512    
     51000   423.07076     -160960.61      25220.61      -135740         63603.835      402592.25      6.2796667      128.961      
     52000   423.02748     -160625.01      25218.03      -135406.98      64006.529      402592.25      6.2796667      133.1245     
     53000   422.31676     -160857.36      25175.662     -135681.7       63709.973      402592.25      6.2796667      137.27981    
     54000   416.10661     -160778.26      24805.455     -135972.8       63743.258      402592.25      6.2796667      141.43782    
     55000   422.58329     -160831.1       25191.551     -135639.55      63626.821      402592.25      6.2796667      145.59361    
     56000   420.33451     -160961.06      25057.494     -135903.57      63605.154      402592.25      6.2796667      149.74772    
     57000   425.88668     -161122         25388.477     -135733.52      63505.88       402592.25      6.2796667      153.91248    
     58000   420.98904     -160822.2       25096.512     -135725.69      63691.535      402592.25      6.2796667      158.07657    
     59000   423.42288     -160764.47      25241.601     -135522.87      63669.648      402592.25      6.2796667      162.22913    
     60000   420.28728     -160711.21      25054.678     -135656.54      63593.278      402592.25      6.2796667      166.38837    
     61000   420.18801     -160919.03      25048.76      -135870.27      63627.251      402592.25      6.2796667      170.55288    
     62000   420.406       -161128.13      25061.755     -136066.37      63455.524      402592.25      6.2796667      174.71581    
     63000   423.71834     -161021.7       25259.214     -135762.48      63557.859      402592.25      6.2796667      178.87403    
     64000   417.17886     -161054.05      24869.375     -136184.68      63587.286      402592.25      6.2796667      183.0305     
     65000   423.77304     -160698.15      25262.475     -135435.68      63859.524      402592.25      6.2796667      187.18353    
     66000   424.25857     -160752.66      25291.419     -135461.24      63880.136      402592.25      6.2796667      191.33981    
     67000   422.0431      -161143.58      25159.348     -135984.23      63460.051      402592.25      6.2796667      195.5081     
     68000   422.33228     -160792.76      25176.587     -135616.17      63646.728      402592.25      6.2796667      199.66935    
     69000   427.11205     -160812.14      25461.525     -135350.61      63708.662      402592.25      6.2796667      203.82733    
     70000   421.3309      -161101.47      25116.892     -135984.58      63477.267      402592.25      6.2796667      207.98632    
Loop time of 207.986 on 1 procs for 50000 steps with 20000 atoms

Performance: 41.541 ns/day, 0.578 hours/ns, 240.400 timesteps/s, 4.808 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 25.234     | 25.234     | 25.234     |   0.0 | 12.13
Neigh   | 1.5753     | 1.5753     | 1.5753     |   0.0 |  0.76
Comm    | 1.2653     | 1.2653     | 1.2653     |   0.0 |  0.61
Output  | 0.019159   | 0.019159   | 0.019159   |   0.0 |  0.01
Modify  | 177.89     | 177.89     | 177.89     |   0.0 | 85.53
Other   |            | 1.999      |            |       |  0.96

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32446 ave       32446 max       32446 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.85516e+06 ave 6.85516e+06 max 6.85516e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14241e+07 ave 1.14241e+07 max 1.14241e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11424086
Ave neighs/atom = 571.2043
Neighbor list builds = 974
Dangerous builds = 0
unfix           nvt

# ========== Finalize ==========
print "========== H100 GPU Simulation completed =========="
========== H100 GPU Simulation completed ==========

# Write restart file for next iteration (use fixed name to avoid shell command issues)
write_restart   outputs/restart.0.data
System init for write_restart ...
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule

# Final statistics
variable        density_final equal density
variable        temp_final equal temp
variable        press_final equal press

print "========================================="
=========================================
print "FINAL RESULTS:"
FINAL RESULTS:
print "  Density:     ${density_final} g/cm^3"
  Density:     6.27966666056993 g/cm^3
print "  Temperature: ${temp_final} K"
  Temperature: 421.330901706098 K
print "  Pressure:    ${press_final} bar"
  Pressure:    63477.2674600826 bar
print "========================================="
=========================================

print "RDF written to rdf.dat"
RDF written to rdf.dat
print "Restart file written to outputs/restart.0.data"
Restart file written to outputs/restart.0.data
Total wall time: 0:04:46
