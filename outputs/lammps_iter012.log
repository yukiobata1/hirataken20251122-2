LAMMPS (22 Jul 2025 - Update 2)
KOKKOS mode with Kokkos version 4.6.2 is enabled
  will use up to 1 GPU(s) per node
  using 1 OpenMP thread(s) per MPI task
package kokkos
# H100 GPU-Optimized LAMMPS input for EPSR simulation of EGaIn eutectic alloy
# Composition: Ga0.858In0.142
# Temperature: 150Â°C (423.15 K)
# Potential: LJ + Empirical Potential (table)
# GPU: Using KOKKOS for H100 (Hopper architecture)

# ========== KOKKOS Initialization (CRITICAL: Must be first) ==========
# CRITICAL FIX: newton off prevents KOKKOS errors on H100
# Note: pair_style table does not have /kk support, but will run on CPU while LJ runs on GPU
package         kokkos neigh full newton off

# ========== Initialization ==========
units           real
atom_style      atomic
boundary        p p p

# ========== Force field ==========
# Use hybrid/overlay to combine LJ (GPU-accelerated) and table (CPU)
# The -sf kk flag will automatically use lj/cut/kk while table runs on CPU
# NOTE: pair_style must be defined BEFORE read_data if data file contains Pair Coeffs section
pair_style      hybrid/overlay lj/cut 12.0 table linear 200

# ========== Read structure ==========
# Use LJ-equilibrated structure as initial configuration (more stable)
shell           mkdir -p outputs
# nocoeff skips Pair Coeffs section which is incompatible with hybrid/overlay
read_data       outputs/final_structure_lj_H100.data nocoeff
Reading data file ...
  orthogonal box = (0 0 0) to (73.839453 73.839453 73.839453)
  1 by 1 by 1 MPI processor grid
WARNING: Pair style lj/cut/kk in data file differs from currently defined pair style zero (src/read_data.cpp:811)
  reading atoms ...
  20000 atoms
  reading velocities ...
  20000 velocities
  read_data CPU = 0.097 seconds

# LJ potential (GPU-accelerated with -sf kk flag)
pair_coeff      1 1 lj/cut 0.430 2.70    # Ga-Ga
pair_coeff      2 2 lj/cut 0.430 3.11    # In-In
pair_coeff      1 2 lj/cut 0.430 2.905   # Ga-In

# Empirical potential (from table files - runs on CPU)
# Table format: r, U(r), F(r)
pair_coeff      1 1 table data/ep_GaGa.table EP_GAGA 12.0
pair_coeff      2 2 table data/ep_InIn.table EP_ININ 12.0
pair_coeff      1 2 table data/ep_GaIn.table EP_GAIN 12.0

# ========== Settings ==========
mass            1 69.723    # Ga
mass            2 114.818   # In

# Optimized neighbor list for GPU
neighbor        2.0 bin
neigh_modify    delay 0 every 1 check yes binsize 4.0

# ========== Initial velocity ==========
# Re-initialize velocities for this temperature
velocity        all create 423.15 12345 dist gaussian

# ========== Thermodynamic output ==========
thermo          1000
thermo_style    custom step temp pe ke etotal press vol density cpu

# ========== Quick minimization for stability ==========
print "========== Energy Minimization =========="
========== Energy Minimization ==========
minimize        1.0e-4 1.0e-6 1000 10000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  2 neighbor lists, perpetual/occasional/extra = 2 0 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
WARNING: Fix MINIMIZE/kk not compatible with sending data in Kokkos communication (src/KOKKOS/comm_kokkos.cpp:767)
WARNING: Fix with atom-based arrays not compatible with sending data in Kokkos communication, switching to classic exchange/border communication (src/KOKKOS/comm_kokkos.cpp:780)
WARNING: Fix MINIMIZE/kk not compatible with Kokkos sorting on device (src/KOKKOS/atom_kokkos.cpp:212)
WARNING: Fix with atom-based arrays not compatible with Kokkos sorting on device, switching to classic host sorting (src/KOKKOS/atom_kokkos.cpp:218)
Per MPI rank memory allocation (min/avg/max) = 13.71 | 13.71 | 13.71 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
         0   423.15        -2571550.4      25225.334     -2546325.1      51808.584      402592.25      6.2796667      0            
        16   423.15        -2599971.4      25225.334     -2574746        46639.047      402592.25      6.2796667      0.024986868  
Loop time of 0.0249927 on 1 procs for 16 steps with 20000 atoms

100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

Minimization stats:
  Stopping criterion = energy tolerance
  Energy initial, next-to-last, final = 
     -2571550.42209283    -2599748.493171  -2599971.38332797
  Force two-norm initial, final = 1378.0626 128.10008
  Force max component initial, final = 42.986495 3.8893518
  Final line search alpha, max atom move = 0.0060113886 0.023380405
  Iterations, force evaluations = 16 16

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.02047    | 0.02047    | 0.02047    |   0.0 | 81.90
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0.0007149  | 0.0007149  | 0.0007149  |   0.0 |  2.86
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0          | 0          | 0          |   0.0 |  0.00
Other   |            | 0.003808   |            |       | 15.24

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32437 ave       32437 max       32437 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.13998e+07 ave 1.13998e+07 max 1.13998e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11399814
Ave neighs/atom = 569.9907
Neighbor list builds = 0
Dangerous builds = 0
reset_timestep  0

# ========== RDF computation ==========
# Compute total and partial pair distribution functions
compute         myrdf all rdf 200 1 1 1 2 2 2 cutoff 12.0

# Time-average RDF output
fix             rdfout all ave/time 100 10 1000 c_myrdf[*] file rdf.dat mode vector

# ========== Equilibration (NVT) ==========
print "========== H100 GPU Equilibration =========="
========== H100 GPU Equilibration ==========

# Start with small timestep for stability
timestep        0.5

fix             nvt all nvt temp 423.15 423.15 100.0
run             5000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  3 neighbor lists, perpetual/occasional/extra = 2 1 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
  (3) compute rdf, occasional
      attributes: half, newton off
      pair build: half/bin/atomonly/newtoff
      stencil: full/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 12.06 | 12.06 | 12.06 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
         0   423.15        -2599971.4      25225.334     -2574746        46639.047      402592.25      6.2796667      0            
      1000   368.27069     -2590717.5      21953.802     -2568763.7      53975.525      402592.25      6.2796667      3.0837344    
      2000   430.41818     -2587804        25658.614     -2562145.4      56367.619      402592.25      6.2796667      6.1627589    
      3000   428.70977     -2588289.4      25556.77      -2562732.6      56273.74       402592.25      6.2796667      9.2391766    
      4000   425.04117     -2588569.8      25338.073     -2563231.7      56124.263      402592.25      6.2796667      12.322424    
      5000   420.89765     -2587463.9      25091.064     -2562372.9      56341.224      402592.25      6.2796667      15.411505    
Loop time of 15.4115 on 1 procs for 5000 steps with 20000 atoms

Performance: 14.015 ns/day, 1.712 hours/ns, 324.433 timesteps/s, 6.489 Matom-step/s
99.9% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 2.5199     | 2.5199     | 2.5199     |   0.0 | 16.35
Neigh   | 0.03937    | 0.03937    | 0.03937    |   0.0 |  0.26
Comm    | 0.052007   | 0.052007   | 0.052007   |   0.0 |  0.34
Output  | 0.0018464  | 0.0018464  | 0.0018464  |   0.0 |  0.01
Modify  | 12.626     | 12.626     | 12.626     |   0.0 | 81.93
Other   |            | 0.1721     |            |       |  1.12

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32488 ave       32488 max       32488 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.84924e+06 ave 6.84924e+06 max 6.84924e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14099e+07 ave 1.14099e+07 max 1.14099e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11409940
Ave neighs/atom = 570.497
Neighbor list builds = 24
Dangerous builds = 0
unfix           nvt

# Increase timestep to normal
timestep        2.0

fix             nvt all nvt temp 423.15 423.15 100.0
run             15000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Per MPI rank memory allocation (min/avg/max) = 38.39 | 38.39 | 38.39 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
      5000   420.89765     -2587463.9      25091.064     -2562372.9      56341.224      402592.25      6.2796667      0            
      6000   425.74084     -2587915.5      25379.783     -2562535.7      56349.473      402592.25      6.2796667      4.1715388    
      7000   422.856       -2588035.4      25207.808     -2562827.6      56107.01       402592.25      6.2796667      8.3466261    
      8000   424.99251     -2587736.8      25335.172     -2562401.6      55977.03       402592.25      6.2796667      12.512877    
      9000   420.75263     -2587907.9      25082.419     -2562825.4      56057.574      402592.25      6.2796667      16.684906    
     10000   422.73644     -2587739.5      25200.68      -2562538.8      56054.196      402592.25      6.2796667      20.857637    
     11000   420.44573     -2587966.9      25064.124     -2562902.7      56217.835      402592.25      6.2796667      25.028699    
     12000   423.10853     -2588287.7      25222.862     -2563064.8      56143.161      402592.25      6.2796667      29.191601    
     13000   423.9796      -2587257.3      25274.789     -2561982.5      56064.931      402592.25      6.2796667      33.352021    
     14000   422.14945     -2587536.3      25165.688     -2562370.7      56189.961      402592.25      6.2796667      37.523922    
     15000   424.64766     -2587706        25314.615     -2562391.4      56061.186      402592.25      6.2796667      41.687433    
     16000   426.72553     -2588054.1      25438.483     -2562615.6      56138.564      402592.25      6.2796667      45.850365    
     17000   425.78183     -2587881.2      25382.226     -2562499        56300.446      402592.25      6.2796667      50.026487    
     18000   419.66259     -2587297.5      25017.438     -2562280        56096.401      402592.25      6.2796667      54.195467    
     19000   421.31375     -2587406.6      25115.869     -2562290.7      56081.149      402592.25      6.2796667      58.362327    
     20000   420.99229     -2588457.1      25096.706     -2563360.4      56080.883      402592.25      6.2796667      62.518111    
Loop time of 62.5181 on 1 procs for 15000 steps with 20000 atoms

Performance: 41.460 ns/day, 0.579 hours/ns, 239.930 timesteps/s, 4.799 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 7.5945     | 7.5945     | 7.5945     |   0.0 | 12.15
Neigh   | 0.47299    | 0.47299    | 0.47299    |   0.0 |  0.76
Comm    | 0.38598    | 0.38598    | 0.38598    |   0.0 |  0.62
Output  | 0.005687   | 0.005687   | 0.005687   |   0.0 |  0.01
Modify  | 53.451     | 53.451     | 53.451     |   0.0 | 85.50
Other   |            | 0.6079     |            |       |  0.97

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32441 ave       32441 max       32441 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:     6.8499e+06 ave  6.8499e+06 max  6.8499e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14134e+07 ave 1.14134e+07 max 1.14134e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11413370
Ave neighs/atom = 570.6685
Neighbor list builds = 294
Dangerous builds = 0
unfix           nvt

# ========== Production (NVT) ==========
print "========== H100 GPU Production run =========="
========== H100 GPU Production run ==========

fix             nvt all nvt temp 423.15 423.15 100.0

# Reset RDF for production run
uncompute       myrdf
compute         myrdf all rdf 200 1 1 1 2 2 2 cutoff 12.0
unfix           rdfout
fix             rdfout all ave/time 100 10 1000 c_myrdf[*] file rdf.dat mode vector

run             50000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  3 neighbor lists, perpetual/occasional/extra = 2 1 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
  (3) compute rdf, occasional
      attributes: half, newton off
      pair build: half/bin/atomonly/newtoff
      stencil: full/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 12.06 | 12.06 | 12.06 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
     20000   420.99229     -2588457.1      25096.706     -2563360.4      56080.883      402592.25      6.2796667      0            
     21000   426.20913     -2587805.9      25407.699     -2562398.2      56102.258      402592.25      6.2796667      4.1718254    
     22000   426.5047      -2587285.5      25425.318     -2561860.2      55997.27       402592.25      6.2796667      8.3458634    
     23000   426.25459     -2588476.6      25410.408     -2563066.2      56112.058      402592.25      6.2796667      12.520144    
     24000   424.13056     -2587308.4      25283.789     -2562024.6      56134.719      402592.25      6.2796667      16.675276    
     25000   423.83323     -2587819.6      25266.064     -2562553.5      55964.727      402592.25      6.2796667      20.844488    
     26000   427.65503     -2587834.7      25493.894     -2562340.8      56054.455      402592.25      6.2796667      25.0103      
     27000   423.33454     -2588288.9      25236.335     -2563052.6      56146.42       402592.25      6.2796667      29.183301    
     28000   423.92417     -2587842.6      25271.485     -2562571.1      56079.987      402592.25      6.2796667      33.348545    
     29000   425.96075     -2587801.5      25392.892     -2562408.6      56186.106      402592.25      6.2796667      37.518202    
     30000   419.73843     -2588122.2      25021.96      -2563100.2      55976.185      402592.25      6.2796667      41.682573    
     31000   425.27311     -2587685.5      25351.9       -2562333.6      56184.215      402592.25      6.2796667      45.852739    
     32000   428.34305     -2587649.2      25534.909     -2562114.3      56164.191      402592.25      6.2796667      50.00613     
     33000   424.68583     -2587913.6      25316.89      -2562596.7      56148.081      402592.25      6.2796667      54.170814    
     34000   421.72424     -2587836        25140.34      -2562695.6      56036.627      402592.25      6.2796667      58.338455    
     35000   421.46754     -2587296.1      25125.037     -2562171        55959.415      402592.25      6.2796667      62.499924    
     36000   419.16282     -2587104.1      24987.645     -2562116.5      56169.472      402592.25      6.2796667      66.678195    
     37000   424.40747     -2587102.2      25300.296     -2561801.9      56026.408      402592.25      6.2796667      70.833432    
     38000   424.13496     -2587695.8      25284.05      -2562411.7      56353.57       402592.25      6.2796667      74.997044    
     39000   423.87773     -2588931.8      25268.717     -2563663.1      56030.685      402592.25      6.2796667      79.150688    
     40000   424.74403     -2587264.8      25320.359     -2561944.4      56430.28       402592.25      6.2796667      83.317125    
     41000   416.4222      -2587547.6      24824.269     -2562723.3      56051.844      402592.25      6.2796667      87.468085    
     42000   426.31323     -2587982.2      25413.905     -2562568.3      56134.127      402592.25      6.2796667      91.638966    
     43000   424.75061     -2588298.2      25320.752     -2562977.4      56078.263      402592.25      6.2796667      95.796139    
     44000   421.29649     -2588311.5      25114.841     -2563196.6      56123.447      402592.25      6.2796667      99.960227    
     45000   424.83201     -2587720.9      25325.604     -2562395.3      56098.334      402592.25      6.2796667      104.12195    
     46000   419.32266     -2587873.5      24997.174     -2562876.3      56156.951      402592.25      6.2796667      108.28569    
     47000   418.37958     -2587429.5      24940.954     -2562488.5      56306.978      402592.25      6.2796667      112.45125    
     48000   422.79671     -2588546.6      25204.274     -2563342.4      55997.746      402592.25      6.2796667      116.62495    
     49000   419.92983     -2588109.2      25033.369     -2563075.8      55877.075      402592.25      6.2796667      120.78422    
     50000   424.67413     -2587376.6      25316.192     -2562060.4      56068.115      402592.25      6.2796667      124.95068    
     51000   423.01205     -2587823.5      25217.11      -2562606.4      56150.116      402592.25      6.2796667      129.10785    
     52000   422.07357     -2587805.2      25161.165     -2562644        56121.775      402592.25      6.2796667      133.26443    
     53000   422.32632     -2587966.7      25176.232     -2562790.5      56033.615      402592.25      6.2796667      137.43355    
     54000   416.45533     -2587433.5      24826.243     -2562607.2      56039.547      402592.25      6.2796667      141.59727    
     55000   421.81908     -2587937.9      25145.993     -2562791.9      56225.778      402592.25      6.2796667      145.76414    
     56000   423.85937     -2588418.3      25267.622     -2563150.7      55971.876      402592.25      6.2796667      149.92487    
     57000   423.48849     -2587127.1      25245.513     -2561881.6      56202.445      402592.25      6.2796667      154.09804    
     58000   423.17798     -2587640.1      25227.002     -2562413.1      56302.509      402592.25      6.2796667      158.26034    
     59000   424.76621     -2587911.5      25321.682     -2562589.8      55968.428      402592.25      6.2796667      162.42088    
     60000   426.21072     -2587851.9      25407.794     -2562444.1      56199.054      402592.25      6.2796667      166.58264    
     61000   423.10449     -2587732        25222.621     -2562509.4      56354.202      402592.25      6.2796667      170.75116    
     62000   422.06934     -2587590.3      25160.912     -2562429.4      56161.907      402592.25      6.2796667      174.92025    
     63000   422.34864     -2588008.8      25177.563     -2562831.2      56026.747      402592.25      6.2796667      179.08564    
     64000   423.28606     -2587240        25233.445     -2562006.6      56179.411      402592.25      6.2796667      183.25067    
     65000   425.07737     -2587965.4      25340.231     -2562625.2      56123.651      402592.25      6.2796667      187.41887    
     66000   424.10935     -2587182        25282.524     -2561899.4      56100.869      402592.25      6.2796667      191.58136    
     67000   431.12055     -2587528.1      25700.484     -2561827.6      56155.581      402592.25      6.2796667      195.75307    
     68000   419.21321     -2587305.2      24990.649     -2562314.6      56004.552      402592.25      6.2796667      199.91752    
     69000   420.05279     -2587378.4      25040.699     -2562337.7      56162.551      402592.25      6.2796667      204.08208    
     70000   421.0518      -2587826.8      25100.254     -2562726.6      56046.152      402592.25      6.2796667      208.24571    
Loop time of 208.246 on 1 procs for 50000 steps with 20000 atoms

Performance: 41.489 ns/day, 0.578 hours/ns, 240.101 timesteps/s, 4.802 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 25.296     | 25.296     | 25.296     |   0.0 | 12.15
Neigh   | 1.5738     | 1.5738     | 1.5738     |   0.0 |  0.76
Comm    | 1.285      | 1.285      | 1.285      |   0.0 |  0.62
Output  | 0.019232   | 0.019232   | 0.019232   |   0.0 |  0.01
Modify  | 178.05     | 178.05     | 178.05     |   0.0 | 85.50
Other   |            | 2.017      |            |       |  0.97

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32356 ave       32356 max       32356 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.84774e+06 ave 6.84774e+06 max 6.84774e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.14123e+07 ave 1.14123e+07 max 1.14123e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11412320
Ave neighs/atom = 570.616
Neighbor list builds = 976
Dangerous builds = 0
unfix           nvt

# ========== Finalize ==========
print "========== H100 GPU Simulation completed =========="
========== H100 GPU Simulation completed ==========

# Write restart file for next iteration (use fixed name to avoid shell command issues)
write_restart   outputs/restart.0.data
System init for write_restart ...
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule

# Final statistics
variable        density_final equal density
variable        temp_final equal temp
variable        press_final equal press

print "========================================="
=========================================
print "FINAL RESULTS:"
FINAL RESULTS:
print "  Density:     ${density_final} g/cm^3"
  Density:     6.27966666056994 g/cm^3
print "  Temperature: ${temp_final} K"
  Temperature: 421.051804169571 K
print "  Pressure:    ${press_final} bar"
  Pressure:    56046.152233372 bar
print "========================================="
=========================================

print "RDF written to rdf.dat"
RDF written to rdf.dat
print "Restart file written to outputs/restart.0.data"
Restart file written to outputs/restart.0.data
Total wall time: 0:04:46
