LAMMPS (22 Jul 2025 - Update 2)
KOKKOS mode with Kokkos version 4.6.2 is enabled
  will use up to 1 GPU(s) per node
  using 1 OpenMP thread(s) per MPI task
package kokkos
# H100 GPU-Optimized LAMMPS input for EPSR simulation of EGaIn eutectic alloy
# Composition: Ga0.858In0.142
# Temperature: 150Â°C (423.15 K)
# Potential: LJ + Empirical Potential (table)
# GPU: Using KOKKOS for H100 (Hopper architecture)

# ========== KOKKOS Initialization (CRITICAL: Must be first) ==========
# CRITICAL FIX: newton off prevents KOKKOS errors on H100
# Note: pair_style table does not have /kk support, but will run on CPU while LJ runs on GPU
package         kokkos neigh full newton off

# ========== Initialization ==========
units           real
atom_style      atomic
boundary        p p p

# ========== Force field ==========
# Use hybrid/overlay to combine LJ (GPU-accelerated) and table (CPU)
# The -sf kk flag will automatically use lj/cut/kk while table runs on CPU
# NOTE: pair_style must be defined BEFORE read_data if data file contains Pair Coeffs section
pair_style      hybrid/overlay lj/cut 12.0 table linear 200

# ========== Read structure ==========
# Use LJ-equilibrated structure as initial configuration (more stable)
shell           mkdir -p outputs
# nocoeff skips Pair Coeffs section which is incompatible with hybrid/overlay
read_data       outputs/final_structure_lj_H100.data nocoeff
Reading data file ...
  orthogonal box = (0 0 0) to (73.839453 73.839453 73.839453)
  1 by 1 by 1 MPI processor grid
WARNING: Pair style lj/cut/kk in data file differs from currently defined pair style zero (src/read_data.cpp:811)
  reading atoms ...
  20000 atoms
  reading velocities ...
  20000 velocities
  read_data CPU = 0.097 seconds

# LJ potential (GPU-accelerated with -sf kk flag)
pair_coeff      1 1 lj/cut 0.430 2.70    # Ga-Ga
pair_coeff      2 2 lj/cut 0.430 3.11    # In-In
pair_coeff      1 2 lj/cut 0.430 2.905   # Ga-In

# Empirical potential (from table files - runs on CPU)
# Table format: r, U(r), F(r)
pair_coeff      1 1 table data/ep_GaGa.table EP_GAGA 12.0
pair_coeff      2 2 table data/ep_InIn.table EP_ININ 12.0
pair_coeff      1 2 table data/ep_GaIn.table EP_GAIN 12.0

# ========== Settings ==========
mass            1 69.723    # Ga
mass            2 114.818   # In

# Optimized neighbor list for GPU
neighbor        2.0 bin
neigh_modify    delay 0 every 1 check yes binsize 4.0

# ========== Initial velocity ==========
# Re-initialize velocities for this temperature
velocity        all create 423.15 12345 dist gaussian

# ========== Thermodynamic output ==========
thermo          1000
thermo_style    custom step temp pe ke etotal press vol density cpu

# ========== Quick minimization for stability ==========
print "========== Energy Minimization =========="
========== Energy Minimization ==========
minimize        1.0e-4 1.0e-6 1000 10000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  2 neighbor lists, perpetual/occasional/extra = 2 0 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
WARNING: Fix MINIMIZE/kk not compatible with sending data in Kokkos communication (src/KOKKOS/comm_kokkos.cpp:767)
WARNING: Fix with atom-based arrays not compatible with sending data in Kokkos communication, switching to classic exchange/border communication (src/KOKKOS/comm_kokkos.cpp:780)
WARNING: Fix MINIMIZE/kk not compatible with Kokkos sorting on device (src/KOKKOS/atom_kokkos.cpp:212)
WARNING: Fix with atom-based arrays not compatible with Kokkos sorting on device, switching to classic host sorting (src/KOKKOS/atom_kokkos.cpp:218)
Per MPI rank memory allocation (min/avg/max) = 13.71 | 13.71 | 13.71 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
         0   423.15         397986.88      25225.334      423212.21      21040.293      402592.25      6.2796667      0            
        48   423.15         370638.14      25225.334      395863.47     -198.97281      402592.25      6.2796667      0.073330545  
Loop time of 0.073337 on 1 procs for 48 steps with 20000 atoms

100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

Minimization stats:
  Stopping criterion = energy tolerance
  Energy initial, next-to-last, final = 
      397986.878936105   370674.872316666    370638.13767986
  Force two-norm initial, final = 1686.7824 55.741312
  Force max component initial, final = 44.773796 3.9684707
  Final line search alpha, max atom move = 0.0093431069 0.037077846
  Iterations, force evaluations = 48 48

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.058375   | 0.058375   | 0.058375   |   0.0 | 79.60
Neigh   | 0.0024472  | 0.0024472  | 0.0024472  |   0.0 |  3.34
Comm    | 0.0029156  | 0.0029156  | 0.0029156  |   0.0 |  3.98
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0          | 0          | 0          |   0.0 |  0.00
Other   |            | 0.0096     |            |       | 13.09

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32403 ave       32403 max       32403 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.13662e+07 ave 1.13662e+07 max 1.13662e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11366232
Ave neighs/atom = 568.3116
Neighbor list builds = 2
Dangerous builds = 0
reset_timestep  0

# ========== RDF computation ==========
# Compute total and partial pair distribution functions
compute         myrdf all rdf 200 1 1 1 2 2 2 cutoff 12.0

# Time-average RDF output
fix             rdfout all ave/time 100 10 1000 c_myrdf[*] file rdf.dat mode vector

# ========== Equilibration (NVT) ==========
print "========== H100 GPU Equilibration =========="
========== H100 GPU Equilibration ==========

# Start with small timestep for stability
timestep        0.5

fix             nvt all nvt temp 423.15 423.15 100.0
run             5000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  3 neighbor lists, perpetual/occasional/extra = 2 1 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
  (3) compute rdf, occasional
      attributes: half, newton off
      pair build: half/bin/atomonly/newtoff
      stencil: full/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 12.06 | 12.06 | 12.06 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
         0   423.15         370638.14      25225.334      395863.47     -198.97281      402592.25      6.2796667      0            
      1000   340.5711       387347.65      20302.54       407650.19      15272.684      402592.25      6.2796667      2.868521     
      2000   430.99685      392332.3       25693.11       418025.41      20409.764      402592.25      6.2796667      5.9337398    
      3000   430.32745      391657.3       25653.205      417310.5       19815.272      402592.25      6.2796667      8.9965918    
      4000   424.9481       391528.48      25332.525      416861.01      19703.849      402592.25      6.2796667      12.060042    
      5000   427.82635      391648.47      25504.107      417152.58      19676.132      402592.25      6.2796667      15.124178    
Loop time of 15.1242 on 1 procs for 5000 steps with 20000 atoms

Performance: 14.282 ns/day, 1.680 hours/ns, 330.596 timesteps/s, 6.612 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 2.5076     | 2.5076     | 2.5076     |   0.0 | 16.58
Neigh   | 0.037532   | 0.037532   | 0.037532   |   0.0 |  0.25
Comm    | 0.049718   | 0.049718   | 0.049718   |   0.0 |  0.33
Output  | 0.0017377  | 0.0017377  | 0.0017377  |   0.0 |  0.01
Modify  | 12.348     | 12.348     | 12.348     |   0.0 | 81.65
Other   |            | 0.1792     |            |       |  1.19

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32512 ave       32512 max       32512 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.82565e+06 ave 6.82565e+06 max 6.82565e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.13713e+07 ave 1.13713e+07 max 1.13713e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11371292
Ave neighs/atom = 568.5646
Neighbor list builds = 23
Dangerous builds = 0
unfix           nvt

# Increase timestep to normal
timestep        2.0

fix             nvt all nvt temp 423.15 423.15 100.0
run             15000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Per MPI rank memory allocation (min/avg/max) = 38.39 | 38.39 | 38.39 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
      5000   427.82635      391648.47      25504.107      417152.58      19676.132      402592.25      6.2796667      0            
      6000   416.78008      391480.66      24845.603      416326.27      19487.257      402592.25      6.2796667      4.1364321    
      7000   420.62233      391152.56      25074.652      416227.21      19425.668      402592.25      6.2796667      8.2684713    
      8000   419.26485      391497.98      24993.728      416491.71      19755.534      402592.25      6.2796667      12.403402    
      9000   423.26373      391325.85      25232.114      416557.96      19609.98       402592.25      6.2796667      16.53929     
     10000   425.28816      391281.25      25352.797      416634.05      19540.791      402592.25      6.2796667      20.693249    
     11000   421.2577       391360.96      25112.528      416473.49      19470.472      402592.25      6.2796667      24.828016    
     12000   424.27359      391317.5       25292.315      416609.81      19477.264      402592.25      6.2796667      28.964763    
     13000   419.69537      391638.45      25019.392      416657.85      19478.535      402592.25      6.2796667      33.103539    
     14000   424.24774      391102.25      25290.774      416393.02      19281.646      402592.25      6.2796667      37.236315    
     15000   428.13958      391233.19      25522.779      416755.97      19380.957      402592.25      6.2796667      41.364732    
     16000   428.41385      391564.78      25539.129      417103.91      19837.967      402592.25      6.2796667      45.495325    
     17000   418.33253      391669.63      24938.149      416607.78      19734.421      402592.25      6.2796667      49.64161     
     18000   420.83258      391515.76      25087.185      416602.94      19713.737      402592.25      6.2796667      53.770738    
     19000   423.40738      391403.47      25240.678      416644.15      19616.122      402592.25      6.2796667      57.9106      
     20000   426.63775      391359.21      25433.25       416792.46      19563.318      402592.25      6.2796667      62.043393    
Loop time of 62.0434 on 1 procs for 15000 steps with 20000 atoms

Performance: 41.777 ns/day, 0.574 hours/ns, 241.766 timesteps/s, 4.835 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 7.5418     | 7.5418     | 7.5418     |   0.0 | 12.16
Neigh   | 0.46119    | 0.46119    | 0.46119    |   0.0 |  0.74
Comm    | 0.3699     | 0.3699     | 0.3699     |   0.0 |  0.60
Output  | 0.0052434  | 0.0052434  | 0.0052434  |   0.0 |  0.01
Modify  | 53.037     | 53.037     | 53.037     |   0.0 | 85.48
Other   |            | 0.628      |            |       |  1.01

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32410 ave       32410 max       32410 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:    6.82006e+06 ave 6.82006e+06 max 6.82006e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.13695e+07 ave 1.13695e+07 max 1.13695e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11369456
Ave neighs/atom = 568.4728
Neighbor list builds = 290
Dangerous builds = 0
unfix           nvt

# ========== Production (NVT) ==========
print "========== H100 GPU Production run =========="
========== H100 GPU Production run ==========

fix             nvt all nvt temp 423.15 423.15 100.0

# Reset RDF for production run
uncompute       myrdf
compute         myrdf all rdf 200 1 1 1 2 2 2 cutoff 12.0
unfix           rdfout
fix             rdfout all ave/time 100 10 1000 c_myrdf[*] file rdf.dat mode vector

run             50000
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 14
  ghost atom cutoff = 14
  binsize = 4, bins = 19 19 19
  3 neighbor lists, perpetual/occasional/extra = 2 1 0
  (1) pair lj/cut, perpetual
      attributes: full, newton off, kokkos_device
      pair build: full/bin/kk/device
      stencil: full/bin/3d
      bin: kk/device
  (2) pair table, perpetual, copy from (1)
      attributes: full, newton off, kokkos_device
      pair build: copy/kk/device
      stencil: none
      bin: none
  (3) compute rdf, occasional
      attributes: half, newton off
      pair build: half/bin/atomonly/newtoff
      stencil: full/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 12.06 | 12.06 | 12.06 Mbytes
   Step          Temp          PotEng         KinEng         TotEng         Press          Volume        Density          CPU      
     20000   426.63775      391359.21      25433.25       416792.46      19563.318      402592.25      6.2796667      0            
     21000   419.62441      391572.63      25015.163      416587.79      19714.808      402592.25      6.2796667      4.1512976    
     22000   421.3296       391268.94      25116.814      416385.76      19328.92       402592.25      6.2796667      8.3027916    
     23000   424.20854      391514.41      25288.437      416802.84      19547.598      402592.25      6.2796667      12.442851    
     24000   422.48788      391436.73      25185.863      416622.59      19750.675      402592.25      6.2796667      16.591492    
     25000   422.88732      391736.68      25209.675      416946.36      19895.045      402592.25      6.2796667      20.734112    
     26000   422.29697      391375.94      25174.482      416550.42      19572.224      402592.25      6.2796667      24.860795    
     27000   420.11022      391278.94      25044.123      416323.07      19534.665      402592.25      6.2796667      28.991579    
     28000   417.86973      391275.56      24910.56       416186.12      19382.923      402592.25      6.2796667      33.127121    
     29000   421.44159      391198.71      25123.49       416322.2       19185.818      402592.25      6.2796667      37.257366    
     30000   423.82964      391230.48      25265.85       416496.33      19592.1        402592.25      6.2796667      41.393297    
     31000   426.04604      391442.55      25397.976      416840.52      19610.341      402592.25      6.2796667      45.545291    
     32000   426.32381      391356.49      25414.535      416771.03      19722.352      402592.25      6.2796667      49.687335    
     33000   421.28644      391654.43      25114.241      416768.67      19785.457      402592.25      6.2796667      53.823757    
     34000   425.24517      391468.15      25350.234      416818.38      19693.669      402592.25      6.2796667      57.978751    
     35000   424.14442      391695.47      25284.614      416980.08      19756.799      402592.25      6.2796667      62.113624    
     36000   424.61502      391313.02      25312.669      416625.69      19444.841      402592.25      6.2796667      66.261464    
     37000   422.29076      391365.13      25174.112      416539.25      19690.915      402592.25      6.2796667      70.397558    
     38000   422.22369      391577.25      25170.114      416747.37      19701.57       402592.25      6.2796667      74.524961    
     39000   422.21598      391824.01      25169.654      416993.67      20024.096      402592.25      6.2796667      78.670165    
     40000   423.20474      391209.92      25228.598      416438.51      19362.182      402592.25      6.2796667      82.811748    
     41000   423.31295      391398.12      25235.048      416633.17      19653.697      402592.25      6.2796667      86.955061    
     42000   422.05444      391146.57      25160.024      416306.59      19212.263      402592.25      6.2796667      91.109694    
     43000   423.02918      391337.21      25218.132      416555.34      19634.663      402592.25      6.2796667      95.25037     
     44000   422.92549      391348.6       25211.95       416560.55      19625.436      402592.25      6.2796667      99.394832    
     45000   419.96616      391365.08      25035.535      416400.62      19660.501      402592.25      6.2796667      103.53526    
     46000   423.092        391238.05      25221.877      416459.92      19400.745      402592.25      6.2796667      107.66526    
     47000   424.11603      391376.96      25282.922      416659.89      19505.29       402592.25      6.2796667      111.79654    
     48000   425.7837       391101.2       25382.337      416483.53      19515.496      402592.25      6.2796667      115.93552    
     49000   420.27268      391618.98      25053.808      416672.79      19734.656      402592.25      6.2796667      120.07404    
     50000   420.83563      391310.76      25087.367      416398.13      19522.742      402592.25      6.2796667      124.20969    
     51000   420.28185      391346.18      25054.354      416400.53      19453.886      402592.25      6.2796667      128.33867    
     52000   420.7399       391349.46      25081.661      416431.12      19658.864      402592.25      6.2796667      132.46901    
     53000   424.4686       391695.72      25303.94       416999.66      19705.654      402592.25      6.2796667      136.60027    
     54000   425.08705      391968.09      25340.808      417308.9       19902.621      402592.25      6.2796667      140.73418    
     55000   423.69293      391617.72      25257.7        416875.42      19560.915      402592.25      6.2796667      144.86888    
     56000   421.51687      391328.7       25127.978      416456.67      19584.992      402592.25      6.2796667      149.01269    
     57000   425.2311       391350.03      25349.395      416699.42      19556.006      402592.25      6.2796667      153.14674    
     58000   417.43395      391386.27      24884.582      416270.85      19344.493      402592.25      6.2796667      157.29195    
     59000   425.55661      391513.42      25368.8        416882.22      19686.886      402592.25      6.2796667      161.42298    
     60000   421.75649      391262.51      25142.263      416404.77      19502.529      402592.25      6.2796667      165.5642     
     61000   418.13816      391368.78      24926.562      416295.35      19655.778      402592.25      6.2796667      169.69509    
     62000   422.34334      391147.47      25177.246      416324.71      19337.109      402592.25      6.2796667      173.82112    
     63000   422.89348      391154.58      25210.042      416364.62      19427.033      402592.25      6.2796667      177.95563    
     64000   422.82575      391601.69      25206.004      416807.7       19763.026      402592.25      6.2796667      182.09561    
     65000   419.28965      391266.32      24995.206      416261.52      19536.836      402592.25      6.2796667      186.22735    
     66000   420.81263      391385.95      25085.996      416471.95      19580.052      402592.25      6.2796667      190.36335    
     67000   424.8214       391520.35      25324.972      416845.32      19798.324      402592.25      6.2796667      194.50136    
     68000   421.14554      391548.73      25105.842      416654.57      19777.629      402592.25      6.2796667      198.63635    
     69000   420.58546      391532.56      25072.454      416605.01      19595.551      402592.25      6.2796667      202.78089    
     70000   424.76172      391478.85      25321.414      416800.27      19716.029      402592.25      6.2796667      206.92549    
Loop time of 206.926 on 1 procs for 50000 steps with 20000 atoms

Performance: 41.754 ns/day, 0.575 hours/ns, 241.633 timesteps/s, 4.833 Matom-step/s
100.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 25.143     | 25.143     | 25.143     |   0.0 | 12.15
Neigh   | 1.5349     | 1.5349     | 1.5349     |   0.0 |  0.74
Comm    | 1.2307     | 1.2307     | 1.2307     |   0.0 |  0.59
Output  | 0.018774   | 0.018774   | 0.018774   |   0.0 |  0.01
Modify  | 176.91     | 176.91     | 176.91     |   0.0 | 85.49
Other   |            | 2.093      |            |       |  1.01

Nlocal:          20000 ave       20000 max       20000 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:          32478 ave       32478 max       32478 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:     6.8247e+06 ave  6.8247e+06 max  6.8247e+06 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:  1.13693e+07 ave 1.13693e+07 max 1.13693e+07 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 11369256
Ave neighs/atom = 568.4628
Neighbor list builds = 968
Dangerous builds = 0
unfix           nvt

# ========== Finalize ==========
print "========== H100 GPU Simulation completed =========="
========== H100 GPU Simulation completed ==========

# Write restart file for next iteration (use fixed name to avoid shell command issues)
write_restart   outputs/restart.0.data
System init for write_restart ...
Generated 0 of 1 mixed pair_coeff terms from geometric mixing rule

# Final statistics
variable        density_final equal density
variable        temp_final equal temp
variable        press_final equal press

print "========================================="
=========================================
print "FINAL RESULTS:"
FINAL RESULTS:
print "  Density:     ${density_final} g/cm^3"
  Density:     6.27966666056994 g/cm^3
print "  Temperature: ${temp_final} K"
  Temperature: 424.761723266763 K
print "  Pressure:    ${press_final} bar"
  Pressure:    19716.0288849567 bar
print "========================================="
=========================================

print "RDF written to rdf.dat"
RDF written to rdf.dat
print "Restart file written to outputs/restart.0.data"
Restart file written to outputs/restart.0.data
Total wall time: 0:04:44
